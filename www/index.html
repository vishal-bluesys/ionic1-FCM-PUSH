<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title></title>

    <link rel="manifest" href="manifest.json">

    <!-- un-comment this code to enable service worker
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(() => console.log('service worker installed'))
          .catch(err => console.log('Error', err));
      }
    </script>-->

    <link href="lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>

    <!-- your app's js -->
    <script src="js/app.js"></script>
    <script src="js/controllers.js"></script>
  </head>

  <body ng-app="starter">
    <ion-nav-view></ion-nav-view>
  </body>
</html>
<script type="text/javascript" charset="utf-8">
	
  document.addEventListener("deviceready", onDeviceReady, false);

function onDeviceReady(){
    document.addEventListener("backbutton", function(e){
          
       
		var checkpath = window.location.href;
	   if( checkpath == 'file:///android_asset/www/index.html#/app/dashboard'){
			 e.preventDefault();
			 //navigator.app.exitApp();
			 window.plugins.appMinimize.minimize();
       }
       else {
           navigator.app.backHistory()
       }
    }, false);

window.FCMPlugin.onNotification(function(data){
  var dt = {"notiid":data.notiid}; 
                       /* $.post("http://abc.com/foldername/index.php/Rest/update_notification_view_time",
                        dt,
                        function(data, status){
                            console.log("Data: " + data + "\nStatus: " + status);
                        });*/
                 
                    var currentlocation=window.location.href;
                    if(data.newlink==undefined)
                    {
                        data.newlink="#/app/playlists";  // path where you want to navigate after clicking on notification
                    }
                    var newloc=currentlocation.split("#")[0]+data.newlink;
                    window.location=newloc;
                                  
                if(data.wasTapped){
                  //Notification was received on device tray and tapped by the user.
                  //alert( JSON.stringify(data) );
                  
                  console.log(data);
                }else{
                  //Notification was received in foreground. Maybe the user needs to be notified.
                  alert( JSON.stringify(data) );
                  console.log(data);
                }

            });

            window.FCMPlugin.onTokenRefresh(function(token){
                    alert( token );
                    console.log(token);

                });

            window.FCMPlugin.getToken(function(token){
                    alert(token);
                    console.log(token);
                  /*  $.post("http://abc.com/icici/index.php/Rest/regtoken", //link where you post the data
                    {
                        regID:token,
                        name:"abc", // name of the client whom you want to put name
                        email:"abc@gmail.com", // emailid of the client if he wants to get his email id
                        platform: device.platform // device platform e.g: ios or android
                    });*/

                });


}
    </script>